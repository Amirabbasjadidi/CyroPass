const clickSound=new Audio("assets/sound/click.mp3");function buildCharsetFromRegex(e){let t="";e.includes("\\w")&&(t+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_"),e.includes("\\d")&&(t+="0123456789"),e.includes("\\sym")&&(t+="!@#$%^&*()_+[]{}|;:,.<>?/`~"),e.includes("?")&&(t+="?"),e.includes("-")&&(t+="-");let n=e.match(/\[(.*?)\]/g);return n&&n.forEach(e=>{let n=expandRanges(e.replace(/[\[\]\\]/g,""));t+=n}),[...new Set(t)].join("")}function expandRanges(e){return e.replace(/([a-zA-Z0-9])\-([a-zA-Z0-9])/g,(e,t,n)=>{let s="";for(let l=t.charCodeAt(0);l<=n.charCodeAt(0);l++)s+=String.fromCharCode(l);return s})}function showCopiedTooltip(){let e=document.createElement("div");e.textContent="Copied!",e.style.position="fixed",e.style.background="#000",e.style.color="#fff",e.style.padding="8px 16px",e.style.borderRadius="8px",e.style.fontSize="14px",e.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.3)",e.style.zIndex="9999",e.style.transition="all 0.5s ease-in-out";let t="ontouchstart"in window||navigator.maxTouchPoints>0;t?(e.style.top="-50px",e.style.left="50%",e.style.transform="translateX(-50%)",document.body.appendChild(e),setTimeout(()=>{e.style.top="20px"},50),setTimeout(()=>{e.style.top="-50px"},2e3)):(e.style.bottom="20px",e.style.left="-200px",document.body.appendChild(e),setTimeout(()=>{e.style.left="20px"},50),setTimeout(()=>{e.style.left="-200px"},2e3)),setTimeout(()=>{e.remove()},2700)}document.getElementById("generate").addEventListener("click",()=>{clickSound.currentTime=0,clickSound.play();let e=parseInt(document.getElementById("length").value,10),t=document.getElementById("regex").value,n=document.getElementById("password"),s=document.getElementById("Ambiguous").checked;try{let l=buildCharsetFromRegex(t);if(!l)throw Error("Empty charset");!s&&(l=l.split("").filter(e=>!"Il1O0".includes(e)).join(""));let o="",a=l.length,d=new Uint32Array(e);window.crypto.getRandomValues(d);for(let r=0;r<e;r++){let i=d[r]%a;o+=l[i]}n.value=o}catch(c){n.value="Invalid Characters!",console.error("Regex error:",c.message)}}),document.getElementById("password").addEventListener("click",()=>{let e=document.getElementById("password"),t=e.value;t&&navigator.clipboard.writeText(t).then(()=>{showCopiedTooltip(e)}).catch(e=>{console.error("Failed to copy!",e)})});const themeToggle=document.getElementById("theme-toggle"),themeIcon=document.getElementById("theme-icon");function updateIcon(){document.body.classList.contains("dark-mode")?(themeIcon.src="assets/images/Night.webp",themeIcon.alt="Light Mode"):(themeIcon.src="assets/images/Day.webp",themeIcon.alt="Dark Mode")}function applySavedTheme(){let e=localStorage.getItem("theme");"dark"===e&&document.body.classList.add("dark-mode"),updateIcon()}function animatedThemeChange(){let e=!document.body.classList.contains("dark-mode");document.body.style.pointerEvents="none",document.body.style.cursor="default";let t=document.createElement("div");t.className="theme-overlay",t.style.background=e?"#1e1e1e":"#ccc",t.style.transformOrigin=e?"top left":"bottom right",t.style.transform="scale(0)",document.body.appendChild(t),requestAnimationFrame(()=>{t.style.transform="scale(1)"}),t.addEventListener("transitionend",function n(){t.removeEventListener("transitionend",n),document.body.classList.toggle("dark-mode",e),localStorage.setItem("theme",e?"dark":"light"),updateIcon(),t.style.transitionDelay="100ms",t.style.transformOrigin=e?"bottom right":"top left",t.style.transform="scale(0)",t.addEventListener("transitionend",()=>{t.remove(),document.body.style.pointerEvents="",document.body.style.cursor=""},{once:!0})})}applySavedTheme(),themeToggle.addEventListener("click",animatedThemeChange);const SETTINGS_KEY="cyropass_settings";function saveSettings(){let e={length:document.getElementById("length").value,regex:document.getElementById("regex").value,ambiguous:document.getElementById("Ambiguous").checked};localStorage.setItem(SETTINGS_KEY,JSON.stringify(e))}function restoreSettings(){let e=localStorage.getItem(SETTINGS_KEY);if(e)try{let t=JSON.parse(e);t.length&&(document.getElementById("length").value=t.length),t.regex&&(document.getElementById("regex").value=t.regex),"boolean"==typeof t.ambiguous&&(document.getElementById("Ambiguous").checked=t.ambiguous)}catch{}}restoreSettings(),["input","change"].forEach(e=>{document.getElementById("length").addEventListener(e,saveSettings),document.getElementById("regex").addEventListener(e,saveSettings),document.getElementById("Ambiguous").addEventListener(e,saveSettings)}),document.getElementById("generate").addEventListener("click",()=>{saveSettings()});const DEFAULTS={regex:"[\\w\\d\\sym?-]"};document.getElementById("reset-regex").addEventListener("click",()=>{let e=document.getElementById("regex");e.value=DEFAULTS.regex,saveSettings(),e.focus()});